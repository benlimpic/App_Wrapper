<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Login</title>
    <link rel="stylesheet" href="/css/output.css" />

    <script th:src="@{/js/fadeAnimations.js}" defer></script>
    <script src="/js/BackButton/visitedPages.js" defer></script>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // Clear the visitedUrls array in sessionStorage when the login page loads
        sessionStorage.setItem("visitedUrls", JSON.stringify([]));
        console.log("Visited URLs reset to empty on login page load.");

        const loginForm = document.querySelector('form[action="/login"]');

        if (loginForm) {
          loginForm.addEventListener("submit", function () {
            // Clear the visitedUrls array again on form submission (optional redundancy)
            sessionStorage.setItem("visitedUrls", JSON.stringify([]));
            console.log("Visited URLs reset to empty on login form submission.");
          });
        }
      });
    </script>
    
  </head>
  <body>
    <header>
      <nav class="navbar">
        <ul class="flex justify-center items-center w-full">
          <li>
            <a href="/index">
              <img
                class="h-5"
                src="/images/Shelved_Logo_White.png"
                alt="Shelved Logo"
              />
            </a>
          </li>
        </ul>
      </nav>
    </header>
    <div class="container bg-slate-200">
      <div class="card">
        <div class="headerBox">
          <h1 class="formHeader">Login</h1>
        </div>

        <div class="errorBox">
          <!-- SUCCESS MESSAGE -->
          <div
            id="successMessageDiv"
            th:if="${param.logout != null}"
            class="success"
          >
            You have been logged out
          </div>
          <!-- ERROR MESSAGE -->
          <div
            id="errorMessageDiv"
            th:if="${param.error != null}"
            class="failure"
          >
            Invalid username or password
          </div>
          <div th:if="${message}" class="success" th:text="${message}"></div>
          <div th:if="${error}" class="success" th:text="${error}"></div>
        </div>

        <form class="formContainer" th:action="@{/login}" method="post">
          <div class="labelInputBox">
            <label class="label" for="Username">Username:</label>
            <input
              class="input"
              label="Username"
              type="text"
              id="username"
              name="username"
              placeholder="Username"
              required
            />
          </div>
          <div class="labelInputBox">
            <label class="label" for="password">Password:</label>
            <input
              class="input"
              type="password"
              id="password"
              name="password"
              placeholder="Password"
              required
            />
          </div>
          <button class="button" type="submit">Login</button>
          <a class="link" href="/signup">Sign Up</a>
        </form>
      </div>
    </div>
  </body>
</html>